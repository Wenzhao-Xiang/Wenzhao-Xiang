<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>OpenCV: Build OpenCV.js</title>
<link href="opencv.ico" rel="shortcut icon" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="tutorial-utils.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
//<![CDATA[
MathJax.Hub.Config(
{
  TeX: {
      Macros: {
          matTT: [ "\\[ \\left|\\begin{array}{ccc} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{array}\\right| \\]", 9],
          fork: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ \\end{array} \\right.", 4],
          forkthree: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ \\end{array} \\right.", 6],
          forkfour: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ #7 & \\mbox{#8}\\\\ \\end{array} \\right.", 8],
          vecthree: ["\\begin{bmatrix} #1\\\\ #2\\\\ #3 \\end{bmatrix}", 3],
          vecthreethree: ["\\begin{bmatrix} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{bmatrix}", 9],
          hdotsfor: ["\\dots", 1],
          mathbbm: ["\\mathbb{#1}", 1],
          bordermatrix: ["\\matrix{#1}", 1]
      }
  }
}
);
//]]>
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<!--#include virtual="/google-search.html"-->
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="opencv-logo-small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenCV
   &#160;<span id="projectnumber">4.1.1-dev</span>
   </div>
   <div id="projectbrief">Open Source Computer Vision</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="tutorial_js_root.html">OpenCV.js Tutorials</a></li><li class="navelem"><a class="el" href="tutorial_js_table_of_contents_setup.html">Introduction to OpenCV.js</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Build OpenCV.js </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Installing Emscripten </h2>
<p><a href="https://github.com/kripken/emscripten">Emscripten</a> is an LLVM-to-JavaScript compiler. We will use Emscripten to build OpenCV.js.</p>
<dl class="section note"><dt>Note</dt><dd>While this describes installation of required tools from scratch, there's a section below also describing an alternative procedure to perform the same build using docker containers which is often easier.</dd></dl>
<p>To Install Emscripten, follow instructions of <a href="https://kripken.github.io/emscripten-site/docs/getting_started/downloads.html">Emscripten SDK</a>.</p>
<p>For example: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;./emsdk update</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;./emsdk install latest</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;./emsdk activate latest</div></div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>To compile to <a href="http://webassembly.org">WebAssembly</a>, you need to install and activate <a href="https://github.com/WebAssembly/binaryen">Binaryen</a> with the <code>emsdk</code> command. Please refer to <a href="http://webassembly.org/getting-started/developers-guide/">Developer's Guide</a> for more details.</dd></dl>
<p>After install, ensure the <code>EMSCRIPTEN</code> environment is setup correctly.</p>
<p>For example: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;source ./emsdk_env.sh</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;echo ${EMSCRIPTEN}</div></div><!-- fragment --><h2>Obtaining OpenCV Source Code </h2>
<p>You can use the latest stable OpenCV version or you can grab the latest snapshot from our <a href="https://github.com/opencv/opencv.git">Git repository</a>.</p>
<h3>Obtaining the Latest Stable OpenCV Version</h3>
<ul>
<li>Go to our <a href="http://opencv.org/releases.html">releases page</a>.</li>
<li>Download the source archive and unpack it.</li>
</ul>
<h3>Obtaining the Cutting-edge OpenCV from the Git Repository</h3>
<p>Launch Git client and clone <a href="http://github.com/opencv/opencv">OpenCV repository</a>.</p>
<p>For example: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;git clone https://github.com/opencv/opencv.git</div></div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>It requires <code>git</code> installed in your development environment.</dd></dl>
<h2>Building OpenCV.js from Source </h2>
<ol type="1">
<li><p class="startli">To build <code>opencv.js</code>, execute python script <code>&lt;opencv_src_dir&gt;/platforms/js/build_js.py &lt;build_dir&gt;</code>.</p>
<p class="startli">For example, to build in <code>build_js</code> directory: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;cd opencv</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;python ./platforms/js/build_js.py build_js</div></div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>It requires <code>python</code> and <code>cmake</code> installed in your development environment.</dd></dl>
</li>
<li><p class="startli">The build script builds asm.js version by default. To build WebAssembly version, append <code>--build_wasm</code> switch.</p>
<p class="startli">For example, to build wasm version in <code>build_wasm</code> directory: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;python ./platforms/js/build_js.py build_wasm --build_wasm</div></div><!-- fragment --></li>
<li><p class="startli">[optional] To build documents, append <code>--build_doc</code> option.</p>
<p class="startli">For example: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;python ./platforms/js/build_js.py build_js --build_doc</div></div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>It requires <code>doxygen</code> installed in your development environment.</dd></dl>
</li>
<li><p class="startli">[optional] To build tests, append <code>--build_test</code> option.</p>
<p class="startli">For example: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;python ./platforms/js/build_js.py build_js --build_test</div></div><!-- fragment --><p class="startli">To run tests, launch a local web server in &lt;build_dir&gt;/bin folder. For example, node http-server which serves on <code>localhost:8080</code>.</p>
<p class="startli">Navigate the web browser to <code><a href="http://localhost:8080/tests.html">http://localhost:8080/tests.html</a></code>, which runs the unit tests automatically.</p>
<p class="startli">You can also run tests using Node.js.</p>
<p class="startli">For example: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;cd bin</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;npm install</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;node tests.js</div></div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>It requires <code>node</code> installed in your development environment.</dd></dl>
</li>
<li><p class="startli">[optional] To build <code>opencv.js</code> with threads optimization, append <code>--threads</code> option.</p>
<p class="startli">For example: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;python ./platforms/js/build_js.py build_js --build_wasm --threads</div></div><!-- fragment --><p class="startli">The default threads number is the logic core number of your device. You can use <code>cv.parallel_pthreads_set_threads_num(number)</code> to set threads number by yourself and use <code>cv.parallel_pthreads_get_threads_num()</code> to get the current threads number.</p>
<dl class="section note"><dt>Note</dt><dd>You should build wasm version of <code>opencv.js</code> if you want to enable this optimization. And the threads optimization only works in browser, not in node.js. You need to enable the <code>WebAssembly threads support</code> feature first with your browser. For example, if you use Chrome, please enable this flag in chrome://flags.</dd></dl>
</li>
<li><p class="startli">[optional] To build <code>opencv.js</code> with wasm simd optimization, append <code>--simd</code> option.</p>
<p class="startli">For example: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;python ./platforms/js/build_js.py build_js --build_wasm --simd</div></div><!-- fragment --><p class="startli">The simd optimization is experimental as wasm simd is still in development.</p>
<dl class="section note"><dt>Note</dt><dd>Now only emscripten LLVM upstream backend supports wasm simd, refering to <a href="https://emscripten.org/docs/porting/simd.html">https://emscripten.org/docs/porting/simd.html</a>. So you need to setup upstream backend environment with the following command first: <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;./emsdk update</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;./emsdk install latest-upstream</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;./emsdk activate latest-upstream</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;source ./emsdk_env.sh</div></div><!-- fragment --></dd>
<dd>
You should build wasm version of <code>opencv.js</code> if you want to enable this optimization. For browser, you need to enable the <code>WebAssembly SIMD support</code> feature first. For example, if you use Chrome, please enable this flag in chrome://flags. For Node.js, you need to run script with flag <code>--experimental-wasm-simd</code>.</dd>
<dd>
The simd version of <code>opencv.js</code> built by latest LLVM upstream may not work with the stable browser or old version of Node.js. Please use the latest version of unstable browser or Node.js to get new features, like <code>Chrome Dev</code>.</dd></dl>
</li>
<li><p class="startli">[optional] To build wasm intrinsics tests, append <code>--build_wasm_intrin_test</code> option.</p>
<p class="startli">For example: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;python ./platforms/js/build_js.py build_js --build_wasm --simd --build_wasm_intrin_test</div></div><!-- fragment --><p class="startli">For wasm intrinsics tests, you can use the following function to test all the cases: </p><div class="fragment"><div class="line"><a class="code" href="d2/d75/namespacecv.html">cv</a>.test_hal_intrin_all()</div></div><!-- fragment --><p class="startli">And the failed cases will be logged in the JavaScript debug console.</p>
<p class="startli">If you only want to test single data type of wasm intrinsics, you can use the following functions: </p><div class="fragment"><div class="line"><a class="code" href="d2/d75/namespacecv.html">cv</a>.test_hal_intrin_uint8()</div><div class="line"><a class="code" href="d2/d75/namespacecv.html">cv</a>.test_hal_intrin_int8()</div><div class="line"><a class="code" href="d2/d75/namespacecv.html">cv</a>.test_hal_intrin_uint16()</div><div class="line"><a class="code" href="d2/d75/namespacecv.html">cv</a>.test_hal_intrin_int16()</div><div class="line"><a class="code" href="d2/d75/namespacecv.html">cv</a>.test_hal_intrin_uint32()</div><div class="line"><a class="code" href="d2/d75/namespacecv.html">cv</a>.test_hal_intrin_int32()</div><div class="line"><a class="code" href="d2/d75/namespacecv.html">cv</a>.test_hal_intrin_uint64()</div><div class="line"><a class="code" href="d2/d75/namespacecv.html">cv</a>.test_hal_intrin_int64()</div><div class="line"><a class="code" href="d2/d75/namespacecv.html">cv</a>.test_hal_intrin_float32()</div><div class="line"><a class="code" href="d2/d75/namespacecv.html">cv</a>.test_hal_intrin_float64()</div></div><!-- fragment --></li>
<li><p class="startli">[optional] To build performance tests, append <code>--build_perf</code> option.</p>
<p class="startli">For example: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;python ./platforms/js/build_js.py build_js --build_perf</div></div><!-- fragment --><p class="startli">To run performance tests, launch a local web server in &lt;build_dir&gt;/bin folder. For example, node http-server which serves on <code>localhost:8080</code>.</p>
<p class="startli">There are some kernels now in the performance test like <code>cvtColor</code>, <code>resize</code> and <code>threshold</code>. For example, if you want to test <code>threshold</code>, please navigate the web browser to <code><a href="http://localhost:8080/perf/perf_imgproc/perf_threshold.html">http://localhost:8080/perf/perf_imgproc/perf_threshold.html</a></code>. You need to input the test parameter like <code>(1920x1080, CV_8UC1, THRESH_BINARY)</code>, and then click the <code>Run</code> button to run the case. And if you don't input the parameter, it will run all the cases of this kernel.</p>
<p class="startli">You can also run tests using Node.js.</p>
<p class="startli">For example, run <code>threshold</code> with parameter <code>(1920x1080, CV_8UC1, THRESH_BINARY)</code>: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;cd bin/perf</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;npm install</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;node perf_threshold.js --test_param_filter=&quot;(1920x1080, CV_8UC1, THRESH_BINARY)&quot;</div></div><!-- fragment --></li>
</ol>
<h2>Building OpenCV.js with Docker </h2>
<p>Alternatively, the same build can be can be accomplished using <a href="https://www.docker.com/">docker</a> containers which is often easier and more reliable, particularly in non linux systems. You only need to install <a href="https://www.docker.com/">docker</a> on your system and use a popular container that provides a clean well tested environment for emscripten builds like this, that already has latest versions of all the necessary tools installed.</p>
<p>So, make sure <a href="https://www.docker.com/">docker</a> is installed in your system and running. The following shell script should work in linux and MacOS:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;git clone https://github.com/opencv/opencv.git</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;cd opencv</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;docker run --rm --workdir /code -v &quot;$PWD&quot;:/code &quot;trzeci/emscripten:latest&quot; python ./platforms/js/build_js.py build_js</div></div><!-- fragment --><p>In Windows use the following PowerShell command:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;docker run --rm --workdir /code -v &quot;$(get-location):/code&quot; &quot;trzeci/emscripten:latest&quot; python ./platforms/js/build_js.py build_js</div></div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>The example uses latest version of <a href="https://hub.docker.com/r/trzeci/emscripten">trzeci/emscripten</a> docker container. At this time, the latest version works fine and is <code>trzeci/emscripten:sdk-tag-1.38.32-64bit</code> </dd></dl>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Aug 22 2019 16:32:40 for OpenCV by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
<script type="text/javascript">
//<![CDATA[
addTutorialsButtons();
//]]>
</script>
</body>
</html>
