<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>OpenCV: OpenCV iOS - Video Processing</title>
<link href="opencv.ico" rel="shortcut icon" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="tutorial-utils.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
//<![CDATA[
MathJax.Hub.Config(
{
  TeX: {
      Macros: {
          matTT: [ "\\[ \\left|\\begin{array}{ccc} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{array}\\right| \\]", 9],
          fork: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ \\end{array} \\right.", 4],
          forkthree: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ \\end{array} \\right.", 6],
          forkfour: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ #7 & \\mbox{#8}\\\\ \\end{array} \\right.", 8],
          vecthree: ["\\begin{bmatrix} #1\\\\ #2\\\\ #3 \\end{bmatrix}", 3],
          vecthreethree: ["\\begin{bmatrix} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{bmatrix}", 9],
          hdotsfor: ["\\dots", 1],
          mathbbm: ["\\mathbb{#1}", 1],
          bordermatrix: ["\\matrix{#1}", 1]
      }
  }
}
);
//]]>
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<!--#include virtual="/google-search.html"-->
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="opencv-logo-small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenCV
   &#160;<span id="projectnumber">4.1.1-dev</span>
   </div>
   <div id="projectbrief">Open Source Computer Vision</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="tutorial_root.html">OpenCV Tutorials</a></li><li class="navelem"><a class="el" href="tutorial_table_of_content_ios.html">OpenCV iOS</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">OpenCV iOS - Video Processing </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This tutorial explains how to process video frames using the iPhone's camera and OpenCV.</p>
<h2>Prerequisites: </h2>
<ul>
<li>Xcode 4.3 or higher</li>
<li>Basic knowledge of iOS programming (Objective-C, Interface Builder)</li>
</ul>
<h2>Including OpenCV library in your iOS project </h2>
<p>The OpenCV library comes as a so-called framework, which you can directly drag-and-drop into your XCode project. Download the latest binary from <a href="http://sourceforge.net/projects/opencvlibrary/files/opencv-ios/">http://sourceforge.net/projects/opencvlibrary/files/opencv-ios/</a>. Alternatively follow this guide <a class="el" href="tutorial_ios_install.html">Installation in iOS</a> to compile the framework manually. Once you have the framework, just drag-and-drop into XCode:</p>
<div class="image">
<img src="xcode_hello_ios_framework_drag_and_drop.png" alt="xcode_hello_ios_framework_drag_and_drop.png"/>
</div>
<p>Also you have to locate the prefix header that is used for all header files in the project. The file is typically located at "ProjectName/Supporting Files/ProjectName-Prefix.pch". There, you have add an include statement to import the opencv library. However, make sure you include opencv before you include UIKit and Foundation, because else you will get some weird compile errors that some macros like min and max are defined multiple times. For example the prefix header could look like the following: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;//</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;// Prefix header for all source files of the &#39;VideoFilters&#39; target in the &#39;VideoFilters&#39; project</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;//</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;#import &lt;Availability.h&gt;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;#ifndef __IPHONE_4_0</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;#warning &quot;This project uses features only available in iOS SDK 4.0 and later.&quot;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;#endif</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;#ifdef __cplusplus</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;#import &lt;opencv2/opencv.hpp&gt;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;#endif</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;#ifdef __OBJC__</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;    #import &lt;UIKit/UIKit.h&gt;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;    #import &lt;Foundation/Foundation.h&gt;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;#endif</div></div><!-- fragment --> <h3>Example video frame processing project</h3>
<h4>User Interface</h4>
<p>First, we create a simple iOS project, for example Single View Application. Then, we create and add an UIImageView and UIButton to start the camera and display the video frames. The storyboard could look like that:</p>
<div class="image">
<img src="xcode_hello_ios_viewcontroller_layout.png" alt="xcode_hello_ios_viewcontroller_layout.png"/>
</div>
<p>Make sure to add and connect the IBOutlets and IBActions to the corresponding ViewController: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;@interface ViewController : UIViewController</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;{</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    IBOutlet UIImageView* imageView;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    IBOutlet UIButton* button;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;}</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;- (IBAction)actionStart:(id)sender;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;@end</div></div><!-- fragment --> <h4>Adding the Camera</h4>
<p>We add a camera controller to the view controller and initialize it when the view has loaded: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;#import &lt;opencv2/videoio/cap_ios.h&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;using namespace cv;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;@interface ViewController : UIViewController</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;{</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    ...</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    CvVideoCamera* videoCamera;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;}</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;...</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;@property (nonatomic, retain) CvVideoCamera* videoCamera;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;@end</div></div><!-- fragment --> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;- (void)viewDidLoad</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;{</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    [super viewDidLoad];</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    // Do any additional setup after loading the view, typically from a nib.</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    self.videoCamera = [[CvVideoCamera alloc] initWithParentView:imageView];</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    self.videoCamera.defaultAVCaptureDevicePosition = AVCaptureDevicePositionFront;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    self.videoCamera.defaultAVCaptureSessionPreset = AVCaptureSessionPreset352x288;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    self.videoCamera.defaultAVCaptureVideoOrientation = AVCaptureVideoOrientationPortrait;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;    self.videoCamera.defaultFPS = 30;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    self.videoCamera.grayscale = NO;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;}</div></div><!-- fragment --><p> In this case, we initialize the camera and provide the imageView as a target for rendering each frame. <a class="el" href="db/da9/interfaceCvVideoCamera.html">CvVideoCamera</a> is basically a wrapper around AVFoundation, so we provide as properties some of the AVFoundation camera options. For example we want to use the front camera, set the video size to 352x288 and a video orientation (the video camera normally outputs in landscape mode, which results in transposed data when you design a portrait application).</p>
<p>The property defaultFPS sets the FPS of the camera. If the processing is less fast than the desired FPS, frames are automatically dropped.</p>
<p>The property grayscale=YES results in a different colorspace, namely "YUV (YpCbCr 4:2:0)", while grayscale=NO will output 32 bit BGRA.</p>
<p>Additionally, we have to manually add framework dependencies of the opencv framework. Finally, you should have at least the following frameworks in your project:</p>
<ul>
<li>opencv2</li>
<li>Accelerate</li>
<li>AssetsLibrary</li>
<li>AVFoundation</li>
<li>CoreGraphics</li>
<li>CoreImage</li>
<li>CoreMedia</li>
<li>CoreVideo</li>
<li>QuartzCore</li>
<li>UIKit</li>
<li><p class="startli">Foundation</p>
<div class="image">
<img src="xcode_hello_ios_frameworks_add_dependencies.png" alt="xcode_hello_ios_frameworks_add_dependencies.png"/>
</div>
</li>
</ul>
<h4>Processing frames</h4>
<p>We follow the delegation pattern, which is very common in iOS, to provide access to each camera frame. Basically, the View Controller has to implement the <a class="el" href="db/dbd/protocolCvVideoCameraDelegate-p.html">CvVideoCameraDelegate</a> protocol and has to be set as delegate to the video camera: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;@interface ViewController : UIViewController&lt;CvVideoCameraDelegate&gt;</div></div><!-- fragment --> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;- (void)viewDidLoad</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;{</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    ...</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    self.videoCamera = [[CvVideoCamera alloc] initWithParentView:imageView];</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    self.videoCamera.delegate = self;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    ...</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;}</div></div><!-- fragment --> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;#pragma mark - Protocol CvVideoCameraDelegate</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;#ifdef __cplusplus</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;- (void)processImage:(Mat&amp;)image;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;{</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    // Do some OpenCV stuff with the image</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;}</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;#endif</div></div><!-- fragment --><p> Note that we are using C++ here (<a class="el" href="d3/d63/classcv_1_1Mat.html" title="n-dimensional dense array class ">cv::Mat</a>). Important: You have to rename the view controller's extension .m into .mm, so that the compiler compiles it under the assumption of Objective-C++ (Objective-C and C++ mixed). Then, __cplusplus is defined when the compiler is processing the file for C++ code. Therefore, we put our code within a block where __cplusplus is defined.</p>
<h4>Basic video processing</h4>
<p>From here you can start processing video frames. For example the following snippet color-inverts the image: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;- (void)processImage:(Mat&amp;)image;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;{</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    // Do some OpenCV stuff with the image</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    Mat image_copy;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    cvtColor(image, image_copy, COLOR_BGR2GRAY);</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    // invert image</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    bitwise_not(image_copy, image_copy);</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;    //Convert BGR to BGRA (three channel to four channel)</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    Mat bgr;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    cvtColor(image_copy, bgr, COLOR_GRAY2BGR);</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;    cvtColor(bgr, image, COLOR_BGR2BGRA);</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;}</div></div><!-- fragment --> <h4>Start!</h4>
<p>Finally, we have to tell the camera to actually start/stop working. The following code will start the camera when you press the button, assuming you connected the UI properly: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;#pragma mark - UI Actions</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;- (IBAction)actionStart:(id)sender;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;{</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    [self.videoCamera start];</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;}</div></div><!-- fragment --> <h4>Hints</h4>
<p>Try to avoid costly matrix copy operations as much as you can, especially if you are aiming for real-time. As the image data is passed as reference, work in-place, if possible.</p>
<p>When you are working on grayscale data, turn set grayscale = YES as the YUV colorspace gives you directly access the luminance plane.</p>
<p>The Accelerate framework provides some CPU-accelerated DSP filters, which come handy in your case. </p>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Aug 22 2019 16:32:39 for OpenCV by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
<script type="text/javascript">
//<![CDATA[
addTutorialsButtons();
//]]>
</script>
</body>
</html>
